## PRD-002: Backend - queue_compute_fair_position command

Status: COMPLETE

Implemented:
- Added compute_fair_position() pure function for algorithm
- Added queue_compute_fair_position Tauri command
- Registered command in lib.rs invoke_handler
- Algorithm: singer with 0 songs -> position 0, singer with N songs -> after their Nth occurrence, respecting singers with fewer songs

Tests added:
- test_fair_position_empty_queue
- test_fair_position_singer_has_zero_songs
- test_fair_position_singer_has_one_song
- test_fair_position_singer_has_more_songs
- test_fair_position_unassigned
- test_fair_position_multiple_singers
- test_fair_position_new_singer_cuts_in
- test_fair_position_respects_order

Verified:
- cargo test queue: 23 passed
- cargo check: warnings only (pre-existing)
- npm run build: passes
- npm run test:run: 287 passed
- npm run lint: passes

Files changed:
- src-tauri/src/commands/queue.rs (added command + tests)
- src-tauri/src/lib.rs (registered command)
- ralph/permanent-shuffle.json (marked PRD-002 passes: true)

## PRD-003: Backend - Fair position algorithm unit tests

Status: COMPLETE

Implemented:
- Added 4 new PRD-specific unit tests for compute_fair_position in queue.rs
- test_prd003_empty_queue_position_zero: verifies empty queue returns position 0
- test_prd003_singer_with_one_song_others_with_zero: tests when only one singer in queue
- test_prd003_singer_with_two_songs_others_with_one: tests A has 2, B/C have 1 - A waits
- test_prd003_unassigned_treated_as_separate_group: verifies UNASSIGNED_SINGER_ID (-1) works
- Added test_fair_position_complex_scenario: tests A:3, B:2, C:1 scenario

Algorithm clarification:
- Algorithm only knows about singers currently IN the queue
- If B/C have 0 songs (not in queue), can't wait for them - that's fair shuffle's job
- compute_fair_position waits for singers with FEWER songs than the new singer

Verified:
- cargo test queue: 24 passed (was 23)
- just check: all checks passed
- npm run test: 287 passed

Files changed:
- src-tauri/src/commands/queue.rs (added PRD-003 tests)
- ralph/permanent-shuffle.json (marked PRD-003 passes: true)

## PRD-004: Frontend Service - computeFairPosition method

Status: COMPLETE

Implemented:
- Added computeFairPosition(singerId: number | null): Promise<number> to queueService
- Method calls invoke('queue_compute_fair_position', { singerId })
- Returns position number from backend

Verified:
- npx tsc --noEmit: passes
- npm run test: 287 passed
- npm run lint: passes

Files changed:
- src/services/queue.ts (added computeFairPosition method)
- ralph/permanent-shuffle.json (marked PRD-004 passes: true)

