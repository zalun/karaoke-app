# App Signals Implementation Progress

## SIG-101: SESSION_STARTED signal (DONE)
- Added `emitSignal` import to sessionStore.ts
- Emit SESSION_STARTED after startSession() completes (line 170)
- Added unit test verifying signal emission
- Updated mock in sessionStore.activeSinger.test.ts to include emitSignal + APP_SIGNALS

Files changed:
- src/stores/sessionStore.ts
- src/stores/sessionStore.test.ts
- src/stores/sessionStore.activeSinger.test.ts
- ralph/app-signals.json

All tests pass. Lint clean.

## SIG-102: SESSION_ENDED signal (DONE)
- Emit SESSION_ENDED at end of endSession() after state cleared and queue reset
- Signal emitted in success path only (errors throw)
- Added unit test following SESSION_STARTED test pattern

Files changed:
- src/stores/sessionStore.ts (line 198)
- src/stores/sessionStore.test.ts (new test)
- ralph/app-signals.json

All tests pass. Lint clean.

## SIG-103: HOSTING_STARTED signal (DONE)
- Emit HOSTING_STARTED after hostSession() set() call and log statement (line 684)
- Signal emitted only in success path (errors thrown before set())
- Added unit test verifying signal emission - needed to reset setHostedSession mock

Files changed:
- src/stores/sessionStore.ts
- src/stores/sessionStore.test.ts (new test)
- ralph/app-signals.json

All tests pass. Lint clean.

## SIG-104: HOSTING_STOPPED signal (DONE)
- Emit HOSTING_STOPPED at end of stopHosting() finally block (line 762)
- Signal emitted in both success AND error paths (per acceptance criteria)
- Placed in finally block so fires regardless of API call outcome
- Added 3 unit tests: success path, error path, skip when no hosted session

Files changed:
- src/stores/sessionStore.ts
- src/stores/sessionStore.test.ts (3 new tests)
- ralph/app-signals.json

All tests pass (483). Lint clean. TypeScript clean.

## SIG-105: QUEUE_ITEM_ADDED signal (DONE)
- Imported emitSignal and APP_SIGNALS in queueStore.ts
- Emit QUEUE_ITEM_ADDED after both addToQueue() and addToQueueNext() complete
- Signal fires after state update, before returning item
- Also emit in addToQueueNext() since it adds items to queue
- Created new test file queueStore.signals.test.ts with 3 tests
- Updated queueStore.fairQueue.test.ts mock to include emitSignal/APP_SIGNALS

Files changed:
- src/stores/queueStore.ts (import + 2 emit calls)
- src/stores/queueStore.signals.test.ts (new file - 3 tests)
- src/stores/queueStore.fairQueue.test.ts (mock update)
- ralph/app-signals.json

All tests pass (486). Lint clean. TypeScript clean.

## SIG-106: QUEUE_ITEM_REMOVED signal (DONE)
- Emit QUEUE_ITEM_REMOVED after removeFromQueue() state update completes
- Signal fires after set() call filters item out
- Added unit test in queueStore.signals.test.ts

Files changed:
- src/stores/queueStore.ts (1 emit call after removeFromQueue)
- src/stores/queueStore.signals.test.ts (1 new test)
- ralph/app-signals.json

All tests pass (487). Lint clean. TypeScript clean.

## SIG-107: SONG_STARTED signal (DONE)
- Imported emitSignal and APP_SIGNALS in playerStore.ts
- Emit SONG_STARTED in playVideo() after setIsPlaying(true) for both YouTube embed and yt-dlp modes
- Created new test file playerStore.signals.test.ts with 3 tests
- Tests cover: YouTube embed mode, yt-dlp mode, no-op when video has no youtubeId

Files changed:
- src/stores/playerStore.ts (import + 2 emit calls in playVideo)
- src/stores/playerStore.signals.test.ts (new file - 3 tests)
- ralph/app-signals.json

All tests pass (490). Lint clean. TypeScript clean.

## SIG-108: SONG_STOPPED signal (DONE)
- Created stopVideo() function in playerStore.ts that:
  - Checks if video is currently playing (currentVideo && isPlaying)
  - Sets isPlaying to false
  - Emits SONG_STOPPED signal
- Call stopVideo() at start of playVideo() to stop current video when switching to a new one
- Exported stopVideo from stores/index.ts
- Added 4 unit tests in playerStore.signals.test.ts:
  - Manual stop emits signal
  - No signal when no video playing
  - No signal when already paused
  - Signal emitted when switching videos (SONG_STOPPED then SONG_STARTED)

Files changed:
- src/stores/playerStore.ts (new stopVideo function, call in playVideo)
- src/stores/index.ts (export stopVideo)
- src/stores/playerStore.signals.test.ts (4 new tests)
- ralph/app-signals.json

All tests pass (494). Lint clean. TypeScript clean.

## SIG-201: SESSION_LOADED signal (DONE)
- Added SESSION_LOADED to APP_SIGNALS constant in appSignals.ts
- Added payload type to SignalPayloads interface (undefined)
- Emit SESSION_LOADED in sessionStore.loadSession() after all init (singers, active singer, queue, assignments, hosted session restore)
- Added test in appSignals.test.ts verifying signal name
- Added 2 unit tests in sessionStore.test.ts:
  - Verifies signal emits after loadSession with active session
  - Verifies signal NOT emitted when no active session

Files changed:
- src/services/appSignals.ts (signal def + payload type)
- src/services/appSignals.test.ts (signal name test)
- src/stores/sessionStore.ts (emit call line 150)
- src/stores/sessionStore.test.ts (2 new tests)
- ralph/app-signals.json

All tests pass (497). Lint clean. TypeScript clean.

## SIG-202: SINGERS_LOADED signal (DONE)
- Added SINGERS_LOADED to APP_SIGNALS constant in appSignals.ts
- Added payload type to SignalPayloads interface (undefined)
- Emit SINGERS_LOADED in sessionStore.loadSingers() after singers are loaded
- Added SESSION_LOADED and SINGERS_LOADED to test mock APP_SIGNALS
- Added 3 unit tests in sessionStore.test.ts:
  - Verifies signal emits after loadSingers with active session
  - Verifies signal NOT emitted when no active session
  - Verifies signal NOT emitted when loading fails

Files changed:
- src/services/appSignals.ts (signal def + payload type)
- src/stores/sessionStore.ts (emit call line 343)
- src/stores/sessionStore.test.ts (mock update + 3 new tests)
- ralph/app-signals.json

All tests pass (500). Lint clean. TypeScript clean.

## SIG-203: QUEUE_LOADED signal (DONE)
- Added QUEUE_LOADED to APP_SIGNALS constant in appSignals.ts
- Added payload type to SignalPayloads interface (undefined)
- Emit QUEUE_LOADED in queueStore.loadPersistedState() after queue/history loaded
- Signal emitted in all 3 cases: state loaded, no persisted state, error
- Added QUEUE_LOADED to queueStore.signals.test.ts mock
- Added 3 unit tests in queueStore.signals.test.ts:
  - Verifies signal emits after loadPersistedState loads state
  - Verifies signal emits when no persisted state exists
  - Verifies signal emits even when loadPersistedState fails
- Added SINGERS_LOADED and QUEUE_LOADED to appSignals.test.ts

Files changed:
- src/services/appSignals.ts (signal def + payload type)
- src/services/appSignals.test.ts (signal name tests)
- src/stores/queueStore.ts (3 emit calls in loadPersistedState)
- src/stores/queueStore.signals.test.ts (mock update + 3 new tests)
- ralph/app-signals.json

All tests pass (503). Lint clean. TypeScript clean.
