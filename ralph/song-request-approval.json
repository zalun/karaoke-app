{
  "feature": "Song Request Approval",
  "description": "Add functionality for hosts to receive notifications about song requests from guests and approve/reject them through a dedicated UI",
  "items": [
    {
      "id": "SRA-001",
      "category": "Types",
      "description": "Create SongRequest type definition with all required fields",
      "steps_to_verify": [
        "File src/types/songRequest.ts exists",
        "SongRequest interface includes: id (string), title (string), status ('pending' | 'approved' | 'rejected' | 'played'), guest_name (string), requested_at (string)",
        "SongRequest interface includes optional fields: youtube_id, artist, duration, thumbnail_url",
        "GroupedRequests interface exists with guestName (string) and requests (SongRequest[]) fields",
        "Types are exported from the file"
      ],
      "passes": true
    },
    {
      "id": "SRA-002",
      "category": "Types",
      "description": "Export song request types from types index",
      "steps_to_verify": [
        "src/types/index.ts exports SongRequest and GroupedRequests types",
        "Types can be imported from 'src/types' in other files"
      ],
      "passes": true
    },
    {
      "id": "SRA-003",
      "category": "Notification System",
      "description": "Extend NotificationAction interface to support onClick callbacks",
      "steps_to_verify": [
        "NotificationAction interface in src/stores/notificationStore.ts has optional onClick property",
        "onClick property is typed as () => void",
        "Existing url property remains optional for external links"
      ],
      "passes": true
    },
    {
      "id": "SRA-004",
      "category": "Notification System",
      "description": "NotificationBar component handles onClick callbacks",
      "steps_to_verify": [
        "NotificationBar in src/components/notification/NotificationBar.tsx renders action buttons",
        "When action has onClick, clicking the button calls the onClick function",
        "When action has url, clicking the button opens the URL (existing behavior)",
        "onClick and url behaviors work independently"
      ],
      "passes": true
    },
    {
      "id": "SRA-005",
      "category": "API Service",
      "description": "Add getRequests method to hosted session service",
      "steps_to_verify": [
        "src/services/hostedSession.ts has getRequests function",
        "Function signature: getRequests(accessToken: string, sessionId: string, status?: string): Promise<SongRequest[]>",
        "Function calls GET /api/session/{id}/requests endpoint",
        "Function passes status as query parameter when provided",
        "Function returns array of SongRequest objects"
      ],
      "passes": true
    },
    {
      "id": "SRA-006",
      "category": "API Service",
      "description": "Add approveRequest method to hosted session service",
      "steps_to_verify": [
        "src/services/hostedSession.ts has approveRequest function",
        "Function signature: approveRequest(accessToken: string, sessionId: string, requestId: string): Promise<void>",
        "Function calls PATCH /api/session/{id}/requests with body { action: 'approve', requestId }"
      ],
      "passes": false
    },
    {
      "id": "SRA-007",
      "category": "API Service",
      "description": "Add rejectRequest method to hosted session service",
      "steps_to_verify": [
        "src/services/hostedSession.ts has rejectRequest function",
        "Function signature: rejectRequest(accessToken: string, sessionId: string, requestId: string): Promise<void>",
        "Function calls PATCH /api/session/{id}/requests with body { action: 'reject', requestId }"
      ],
      "passes": false
    },
    {
      "id": "SRA-008",
      "category": "API Service",
      "description": "Add approveAllRequests method to hosted session service",
      "steps_to_verify": [
        "src/services/hostedSession.ts has approveAllRequests function",
        "Function signature: approveAllRequests(accessToken: string, sessionId: string, requestIds: string[]): Promise<void>",
        "Function calls PATCH /api/session/{id}/requests with body { action: 'approve', requestIds: [...] }"
      ],
      "passes": false
    },
    {
      "id": "SRA-009",
      "category": "Session Store",
      "description": "Add pending requests state to session store",
      "steps_to_verify": [
        "src/stores/sessionStore.ts has pendingRequests state field typed as SongRequest[]",
        "src/stores/sessionStore.ts has previousPendingCount state field typed as number",
        "src/stores/sessionStore.ts has showRequestsModal state field typed as boolean",
        "src/stores/sessionStore.ts has isLoadingRequests state field typed as boolean",
        "Initial values are set appropriately (empty array, 0, false, false)"
      ],
      "passes": false
    },
    {
      "id": "SRA-010",
      "category": "Session Store",
      "description": "Add loadPendingRequests action to session store",
      "steps_to_verify": [
        "src/stores/sessionStore.ts has loadPendingRequests action",
        "Action sets isLoadingRequests to true while loading",
        "Action calls hostedSession.getRequests with status='pending'",
        "Action updates pendingRequests state with results",
        "Action sets isLoadingRequests to false after completion",
        "Action handles errors gracefully"
      ],
      "passes": false
    },
    {
      "id": "SRA-011",
      "category": "Session Store",
      "description": "Add approveRequest action to session store",
      "steps_to_verify": [
        "src/stores/sessionStore.ts has approveRequest action accepting requestId string",
        "Action calls hostedSession.approveRequest",
        "Action removes the approved request from pendingRequests state",
        "Action refreshes the hosted session to update stats"
      ],
      "passes": false
    },
    {
      "id": "SRA-012",
      "category": "Session Store",
      "description": "Add rejectRequest action to session store",
      "steps_to_verify": [
        "src/stores/sessionStore.ts has rejectRequest action accepting requestId string",
        "Action calls hostedSession.rejectRequest",
        "Action removes the rejected request from pendingRequests state",
        "Action refreshes the hosted session to update stats"
      ],
      "passes": false
    },
    {
      "id": "SRA-013",
      "category": "Session Store",
      "description": "Add approveAllRequests action to session store",
      "steps_to_verify": [
        "src/stores/sessionStore.ts has approveAllRequests action",
        "Action accepts optional guestName parameter to filter requests",
        "When guestName provided, only approves requests from that guest",
        "When guestName not provided, approves all pending requests",
        "Action calls hostedSession.approveAllRequests with array of request IDs",
        "Action removes approved requests from pendingRequests state",
        "Action refreshes the hosted session to update stats"
      ],
      "passes": false
    },
    {
      "id": "SRA-014",
      "category": "Session Store",
      "description": "Add modal control actions to session store",
      "steps_to_verify": [
        "src/stores/sessionStore.ts has openRequestsModal action",
        "openRequestsModal sets showRequestsModal to true",
        "openRequestsModal calls loadPendingRequests to fetch fresh data",
        "src/stores/sessionStore.ts has closeRequestsModal action",
        "closeRequestsModal sets showRequestsModal to false"
      ],
      "passes": false
    },
    {
      "id": "SRA-015",
      "category": "Session Store",
      "description": "Add notification trigger for new requests in refreshHostedSession",
      "steps_to_verify": [
        "refreshHostedSession in src/stores/sessionStore.ts tracks previousPendingCount",
        "When pendingRequests count increases, a notification is shown",
        "Notification message shows the number of new requests",
        "Notification has 'View' action button with onClick callback",
        "Clicking 'View' action calls openRequestsModal",
        "previousPendingCount is updated after comparison"
      ],
      "passes": false
    },
    {
      "id": "SRA-016",
      "category": "UI Component",
      "description": "Create SongRequestsModal component file",
      "steps_to_verify": [
        "File src/components/session/SongRequestsModal.tsx exists",
        "Component is a React functional component",
        "Component is exported as default or named export"
      ],
      "passes": false
    },
    {
      "id": "SRA-017",
      "category": "UI Component",
      "description": "SongRequestsModal has proper modal structure",
      "steps_to_verify": [
        "Modal has fixed overlay with bg-black/50 background",
        "Modal container has bg-gray-800, rounded-lg, padding, max-width ~500px",
        "Modal has max-height constraint (~80vh) with overflow scroll for content",
        "Modal renders only when showRequestsModal is true from session store"
      ],
      "passes": false
    },
    {
      "id": "SRA-018",
      "category": "UI Component",
      "description": "SongRequestsModal has header with title and close button",
      "steps_to_verify": [
        "Modal header displays 'Song Requests' title",
        "Header has close button (X icon)",
        "Clicking close button calls closeRequestsModal from session store"
      ],
      "passes": false
    },
    {
      "id": "SRA-019",
      "category": "UI Component",
      "description": "SongRequestsModal groups requests by guest name",
      "steps_to_verify": [
        "Requests are grouped by guest_name field",
        "Each group has a header showing the guest name",
        "Each group header has 'Approve All' button for that guest",
        "Clicking group 'Approve All' calls approveAllRequests with guestName filter"
      ],
      "passes": false
    },
    {
      "id": "SRA-020",
      "category": "UI Component",
      "description": "SongRequestsModal displays request items with details",
      "steps_to_verify": [
        "Each request item shows thumbnail (if available)",
        "Each request item shows song title",
        "Each request item shows artist (if available)",
        "Each request item shows duration (if available, formatted as mm:ss)",
        "Each request item has approve button (checkmark icon)",
        "Each request item has reject button (X icon)",
        "Clicking approve calls approveRequest with request ID",
        "Clicking reject calls rejectRequest with request ID"
      ],
      "passes": false
    },
    {
      "id": "SRA-021",
      "category": "UI Component",
      "description": "SongRequestsModal has global Approve All button in footer",
      "steps_to_verify": [
        "Modal footer has 'Approve All' button",
        "Button is styled prominently (e.g., blue background)",
        "Clicking button calls approveAllRequests without guestName filter",
        "Button is disabled or hidden when no pending requests"
      ],
      "passes": false
    },
    {
      "id": "SRA-022",
      "category": "UI Component",
      "description": "SongRequestsModal shows empty state",
      "steps_to_verify": [
        "When pendingRequests is empty, shows appropriate empty state message",
        "Empty state message indicates no pending requests",
        "Approve All buttons are not shown in empty state"
      ],
      "passes": false
    },
    {
      "id": "SRA-023",
      "category": "UI Component",
      "description": "SongRequestsModal shows loading state",
      "steps_to_verify": [
        "When isLoadingRequests is true, shows loading indicator",
        "Loading indicator is centered in modal content area",
        "Action buttons are disabled during loading"
      ],
      "passes": false
    },
    {
      "id": "SRA-024",
      "category": "UI Component",
      "description": "Export SongRequestsModal from session components index",
      "steps_to_verify": [
        "src/components/session/index.ts exports SongRequestsModal",
        "Component can be imported from 'src/components/session'"
      ],
      "passes": false
    },
    {
      "id": "SRA-025",
      "category": "App Integration",
      "description": "Add requests button to queue panel header",
      "steps_to_verify": [
        "src/App.tsx has button with Inbox icon in queue panel header",
        "Button is positioned before the fair queue toggle",
        "Button only renders when hostedSession exists",
        "Button has appropriate hover styles (text-gray-400 to text-blue-400)",
        "Button has title attribute showing pending count"
      ],
      "passes": false
    },
    {
      "id": "SRA-026",
      "category": "App Integration",
      "description": "Requests button shows badge with pending count",
      "steps_to_verify": [
        "Badge appears when pendingRequests count > 0",
        "Badge shows the actual pending count number",
        "Badge shows '99+' when count exceeds 99",
        "Badge is styled as small circle (bg-blue-500, text-white, rounded-full)",
        "Badge is positioned at top-right corner of button (-top-1 -right-1)"
      ],
      "passes": false
    },
    {
      "id": "SRA-027",
      "category": "App Integration",
      "description": "Clicking requests button opens modal",
      "steps_to_verify": [
        "Clicking the requests button calls openRequestsModal from session store",
        "Modal becomes visible after clicking button"
      ],
      "passes": false
    },
    {
      "id": "SRA-028",
      "category": "App Integration",
      "description": "Render SongRequestsModal in App component",
      "steps_to_verify": [
        "src/App.tsx imports SongRequestsModal component",
        "SongRequestsModal is rendered in the component tree",
        "Modal receives necessary props or accesses store directly"
      ],
      "passes": false
    },
    {
      "id": "SRA-029",
      "category": "Integration",
      "description": "Approving a request adds song to queue",
      "steps_to_verify": [
        "After approving a request, the song appears in the queue",
        "Song is added with correct metadata (title, artist, youtube_id, etc.)",
        "Queue updates in real-time after approval"
      ],
      "passes": false
    },
    {
      "id": "SRA-030",
      "category": "Integration",
      "description": "Notification appears when new requests arrive during active session",
      "steps_to_verify": [
        "When refreshHostedSession detects increased pending count, notification appears",
        "Notification shows correct count of new requests",
        "Notification has 'info' type styling",
        "Notification 'View' action opens the requests modal"
      ],
      "passes": false
    }
  ]
}
